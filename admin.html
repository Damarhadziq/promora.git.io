<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Verifikasi Seller | Promora</title>
  <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#7A5AF8",
            },
          },
        },
      };
    </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
  <style>
    .status-pending { @apply bg-yellow-100 text-yellow-800 border border-yellow-200 }
    .status-verified { @apply bg-green-100 text-green-800 border border-green-200 }
    .status-rejected { @apply bg-red-100 text-red-800 border border-red-200 }
    .tab-active { @apply border-b-4 border-[#7A5AF8] text-[#7A5AF8] font-semibold }
    .tab-inactive { @apply text-gray-500 hover:text-gray-800 border-b-4 border-transparent }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(20px); }
        to   { opacity: 1; transform: translateY(0); }
    }
    .animate-slide-in { animation: slideIn 0.4s ease-out; }

    .modal-backdrop { backdrop-filter: blur(6px); }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

  <div class="flex">
    <!-- Sidebar -->
    <div class="w-64 bg-gradient-to-b from-[#7A5AF8] to-[#6347d8] text-white min-h-screen p-6 shadow-2xl">
      <div class="mb-10">
        <h1 class="text-2xl font-bold flex items-center gap-2">
          <i class="ri-shield-check-line text-3xl"></i> Promora Admin
        </h1>
        <p class="text-sm text-purple-200 mt-1">Panel Verifikasi</p>
      </div>
      <ul class="space-y-2">
        <li><a href="#" class="flex items-center space-x-3 bg-white bg-opacity-20 px-4 py-3 rounded-xl"><i class="ri-user-search-line text-xl"></i><span>Verifikasi Seller</span></a></li>
        <li class="pt-4 mt-4 border-t border-white border-opacity-20">
          <a href="#" onclick="logoutAdmin(event)" class="flex items-center space-x-3 opacity-70 hover:opacity-100 hover:bg-red-500 hover:bg-opacity-20 px-4 py-3 rounded-xl transition-all">
            <i class="ri-logout-box-line text-xl"></i><span>Logout</span>
          </a>
        </li>
      </ul>
      <div class="mt-8 bg-white bg-opacity-10 rounded-xl p-4">
        <h3 class="text-sm font-semibold mb-3 opacity-80">Ringkasan Hari Ini</h3>
        <div class="space-y-2 text-sm">
          <div class="flex justify-between"><span class="opacity-80">Pending:</span><span class="font-bold" id="sidebar-pending">0</span></div>
          <div class="flex justify-between"><span class="opacity-80">Diverifikasi:</span><span class="font-bold" id="sidebar-verified">0</span></div>
          <div class="flex justify-between"><span class="opacity-80">Ditolak:</span><span class="font-bold" id="sidebar-rejected">0</span></div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 p-8">
      <div class="flex justify-between items-center mb-8">
        <div>
          <h2 class="text-3xl font-bold text-gray-800">Verifikasi Seller Baru</h2>
          <p class="text-gray-500 mt-1">Kelola dan verifikasi pendaftaran seller</p>
        </div>
        <div class="flex items-center gap-4">
          <button onclick="refreshData()" class="px-4 py-2 bg-white border rounded-xl hover:bg-gray-50 flex items-center gap-2">
            <i class="ri-refresh-line"></i> Refresh
          </button>
          <div class="flex items-center gap-2 bg-white px-4 py-2 rounded-xl shadow-sm">
            <i class="ri-calendar-line text-gray-500"></i>
            <span class="text-sm" id="current-date"></span>
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-gradient-to-br from-yellow-400 to-yellow-500 rounded-2xl p-6 text-white shadow-lg">
          <p class="text-yellow-100 text-sm">Menunggu</p>
          <h3 class="text-4xl font-bold mt-2" id="stat-pending">0</h3>
        </div>
        <div class="bg-gradient-to-br from-green-400 to-green-500 rounded-2xl p-6 text-white shadow-lg">
          <p class="text-green-100 text-sm">Terverifikasi</p>
          <h3 class="text-4xl font-bold mt-2" id="stat-verified">0</h3>
        </div>
        <div class="bg-gradient-to-br from-red-400 to-red-500 rounded-2xl p-6 text-white shadow-lg">
          <p class="text-red-100 text-sm">Ditolak</p>
          <h3 class="text-4xl font-bold mt-2" id="stat-rejected">0</h3>
        </div>
        <div class="bg-gradient-to-br from-blue-400 to-blue-500 rounded-2xl p-6 text-white shadow-lg">
          <p class="text-blue-100 text-sm">Total Seller</p>
          <h3 class="text-4xl font-bold mt-2" id="stat-total">0</h3>
        </div>
      </div>

      <!-- Tabs -->
      <div class="flex space-x-8 border-b mb-8">
        <button onclick="loadSellers('pending')"   id="tab-pending"   class="pb-4 px-2 tab-active">Menunggu Verifikasi <span class="ml-2 bg-yellow-100 text-yellow-800 text-xs px-2.5 py-1 rounded-full font-semibold" id="count-pending">0</span></button>
        <button onclick="loadSellers('verified')"  id="tab-verified"  class="pb-4 px-2 tab-inactive">Terverifikasi <span class="ml-2 bg-green-100 text-green-800 text-xs px-2.5 py-1 rounded-full font-semibold" id="count-verified">0</span></button>
        <button onclick="loadSellers('rejected')"  id="tab-rejected"  class="pb-4 px-2 tab-inactive">Ditolak <span class="ml-2 bg-red-100 text-red-800 text-xs px-2.5 py-1 rounded-full font-semibold" id="count-rejected">0</span></button>
      </div>

      <!-- Search & Filter -->
      <div class="mb-6 flex gap-4">
        <div class="flex-1 relative">
          <i class="ri-search-line absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
          <input type="text" id="search" placeholder="Cari nama, email, username..." class="w-full pl-12 pr-5 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-[#7A5AF8]" oninput="filterSellers()">
        </div>
        <select id="filter-date" onchange="filterSellers()" class="px-5 py-3 border rounded-xl">
          <option value="">Semua Tanggal</option>
          <option value="today">Hari ini</option>
          <option value="week">7 Hari Terakhir</option>
          <option value="month">Bulan Ini</option>
        </select>
      </div>

      <!-- Table -->
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gradient-to-r from-gray-50 to-gray-100">
              <tr>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Seller</th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Kontak</th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Tanggal Daftar</th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Dokumen</th>
                <th class="px-6 py-4 text-left text-sm font-semibold text-gray-700">Status</th>
                <th class="px-6 py-4 text-center text-sm font-semibold text-gray-700">Aksi</th>
              </tr>
            </thead>
            <tbody id="seller-list"></tbody>
          </table>
        </div>
        <div id="empty-state" class="hidden py-16 text-center">
          <i class="ri-inbox-line text-6xl text-gray-300 mb-4"></i>
          <h3 class="text-xl font-semibold text-gray-600">Tidak ada data</h3>
        </div>
      </div>

      <!-- Pagination -->
      <div class="mt-6 flex justify-between items-center">
        <div class="text-sm text-gray-500">Menampilkan <span id="showing-count">0</span> dari <span id="total-count">0</span> data</div>
        <div class="flex gap-2" id="pagination-numbers"></div>
      </div>
    </div>
  </div>

 <!-- Modal Detail -->
<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 modal-backdrop hidden items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90vh] overflow-y-auto animate-slide-in">
    <div class="sticky top-0 bg-white border-b px-8 py-6 flex justify-between items-center z-10">
      <div>
        <h3 class="text-2xl font-bold">Detail & Verifikasi Seller</h3>
        <p class="text-sm text-gray-500 mt-1">Periksa data dengan teliti</p>
      </div>
      <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
        <i class="ri-close-line text-3xl"></i>
      </button>
    </div>
    
    <div class="p-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <!-- Data Diri -->
        <div class="space-y-5">
          <h4 class="font-bold text-lg border-b pb-3 flex items-center gap-2">
            <i class="ri-user-line text-[#7A5AF8]"></i> Data Diri
          </h4>
          <div>
            <p class="text-sm text-gray-500">Nama Lengkap</p>
            <p class="font-semibold text-lg" id="modal-name">-</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Username</p>
            <p class="font-semibold" id="modal-username">-</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Email</p>
            <p class="font-semibold" id="modal-email">-</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">No. Telepon</p>
            <p class="font-semibold" id="modal-phone">-</p>
          </div>
          <div>
            <p class="text-sm text-gray-500">Tanggal Daftar</p>
            <p class="font-semibold" id="modal-date">-</p>
          </div>
        </div>

        <!-- Foto KTP -->
        <div>
          <h4 class="font-bold text-lg border-b pb-3 mb-4 flex items-center gap-2">
            <i class="ri-id-card-line text-[#7A5AF8]"></i> Foto KTP
          </h4>
          <div class="border-2 border-dashed border-gray-200 rounded-xl overflow-hidden bg-gray-50 relative group">
            <img id="modal-ktp" src="" alt="KTP" class="w-full cursor-pointer hover:opacity-90 transition-opacity" onclick="openZoomModal()">
            <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all flex items-center justify-center">
              <i class="ri-zoom-in-line text-4xl text-white opacity-0 group-hover:opacity-100 transition-opacity"></i>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-3 text-center flex items-center justify-center gap-2">
            <i class="ri-information-line"></i> Klik gambar untuk memperbesar
          </p>
        </div>
      </div>

      <!-- Action Buttons -->
      <div id="action-buttons" class="flex gap-4">
        <button onclick="verifySeller(currentSellerId, 'verified')" 
                class="flex-1 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transition-all">
          <i class="ri-checkbox-circle-line text-2xl"></i> Verifikasi Seller
        </button>
        <button onclick="showRejectReason()" 
                class="flex-1 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-4 rounded-xl flex items-center justify-center gap-2 shadow-lg hover:shadow-xl transition-all">
          <i class="ri-close-circle-line text-2xl"></i> Tolak Pendaftaran
        </button>
      </div>

      <!-- Reject Reason Form -->
      <div id="reject-reason" class="mt-6 hidden">
        <div class="bg-red-50 border-2 border-red-200 rounded-xl p-6">
          <label class="block text-sm font-semibold text-gray-700 mb-3">
            Alasan Penolakan <span class="text-red-500">*</span>
          </label>
          <textarea id="reject-textarea" 
                    class="w-full px-4 py-3 border-2 border-red-200 rounded-xl focus:border-red-400 focus:ring-2 focus:ring-red-200 outline-none" 
                    rows="4" 
                    placeholder="Contoh: Foto KTP buram / Data tidak sesuai / Dokumen tidak lengkap..."></textarea>
          <div class="mt-4 flex gap-3">
            <button onclick="verifySeller(currentSellerId, 'rejected')" 
                    class="flex-1 bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 transition-all">
              <i class="ri-send-plane-fill"></i> Konfirmasi Tolak
            </button>
            <button onclick="hideRejectReason()" 
                    class="px-6 py-3 bg-gray-200 hover:bg-gray-300 rounded-xl font-semibold transition-all">
              Batal
            </button>
          </div>
        </div>
      </div>

      <!-- Info jika sudah diverifikasi/ditolak -->
      <div id="verified-info" class="hidden mt-6 bg-green-50 border-2 border-green-200 rounded-xl p-6">
        <div class="flex items-center gap-3 mb-2">
          <i class="ri-checkbox-circle-fill text-3xl text-green-600"></i>
          <h4 class="font-bold text-green-800">Seller Sudah Diverifikasi</h4>
        </div>
        <p class="text-sm text-gray-600" id="verified-date">-</p>
      </div>

      <div id="rejected-info" class="hidden mt-6 bg-red-50 border-2 border-red-200 rounded-xl p-6">
        <div class="flex items-center gap-3 mb-2">
          <i class="ri-close-circle-fill text-3xl text-red-600"></i>
          <h4 class="font-bold text-red-800">Seller Ditolak</h4>
        </div>
        <p class="text-sm text-gray-600 mb-2"><strong>Alasan:</strong></p>
        <p class="text-sm text-gray-700 bg-white p-3 rounded-lg" id="rejected-reason">-</p>
      </div>
    </div>
  </div>
</div>

  <!-- Zoom Modal -->
  <div id="zoom-modal" class="fixed inset-0 bg-black bg-opacity-90 hidden items-center justify-center z-[60] p-8" onclick="closeZoomModal()">
    <img id="zoomed-ktp" class="max-w-full max-h-full rounded-xl" src="" alt="">
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed top-4 right-4 bg-white rounded-xl shadow-2xl p-4 z-50 hidden animate-slide-in min-w-[320px]">
    <div class="flex items-center gap-3">
      <div id="toast-icon" class="w-10 h-10 rounded-lg flex items-center justify-center text-white"></div>
      <div>
        <h4 id="toast-title" class="font-semibold"></h4>
        <p id="toast-message" class="text-sm text-gray-600"></p>
      </div>
    </div>
  </div>

<script>
    let allSellers = [];
    let filteredSellers = [];
    let currentStatus = 'pending';
    let currentPage = 1;
    const itemsPerPage = 10;
    let currentSellerId = null;

    // Cek login admin
    if (!localStorage.getItem('adminLoggedIn')) {
      window.location.href = 'loginAdmin.html';
    }

    document.addEventListener('DOMContentLoaded', () => {
      updateCurrentDate();
      loadSellers('pending');
      setInterval(updateCurrentDate, 60000);
    });

    function updateCurrentDate() {
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
      document.getElementById('current-date').textContent = new Date().toLocaleDateString('id-ID', options);
    }

    async function loadSellers(status) {
      currentStatus = status;
      
      try {
        const searchQuery = document.getElementById('search').value;
        const dateFilter = document.getElementById('filter-date').value;
        
        const response = await fetch(`backend/api/get_sellers.php?status=${status}&search=${searchQuery}&date_filter=${dateFilter}`);
        const result = await response.json();

        if (result.success) {
          allSellers = result.data;
          document.querySelectorAll('[id^="tab-"]').forEach(t => {
            t.classList.remove('tab-active');
            t.classList.add('tab-inactive');
          });
          document.getElementById(`tab-${status}`).classList.remove('tab-inactive');
          document.getElementById(`tab-${status}`).classList.add('tab-active');
          
          filterSellers();
          updateStats();
        }
      } catch (error) {
        console.error('Error loading sellers:', error);
        showToast('error', 'Error', 'Gagal memuat data seller');
      }
    }

    function filterSellers() {
      filteredSellers = allSellers;
      currentPage = 1;
      renderTable();
      renderPagination();
    }

function renderTable() {
  const tbody = document.getElementById('seller-list');
  const emptyState = document.getElementById('empty-state');
  tbody.innerHTML = '';
  
  const start = (currentPage - 1) * itemsPerPage;
  const pageData = filteredSellers.slice(start, start + itemsPerPage);

  if (pageData.length === 0) {
    emptyState.classList.remove('hidden');
    document.getElementById('showing-count').textContent = '0';
    document.getElementById('total-count').textContent = '0';
    return;
  } else {
    emptyState.classList.add('hidden');
  }

  pageData.forEach(s => {
    const statusLabel = s.status === 'pending' ? 'Menunggu' : 
                        s.status === 'verified' ? 'Terverifikasi' : 'Ditolak';
    
    const hasKtp = s.ktp_photo && s.ktp_photo !== '';
    
    // Escape JSON untuk onclick
    const sellerJson = JSON.stringify(s).replace(/"/g, '&quot;');
    
    const ktpButton = hasKtp 
      ? `<button onclick='openModal(${JSON.stringify(s).replace(/'/g, "\\'")})'  class="text-[#7A5AF8] hover:underline font-medium">
           <i class="ri-image-line"></i> Lihat KTP
         </button>`
      : `<span class="text-gray-400 text-sm">Tidak ada foto</span>`;
    
    const actionButton = s.status === 'pending'
      ? `<button onclick='openModal(${JSON.stringify(s).replace(/'/g, "\\'")})'  
                 class="text-white bg-[#7A5AF8] hover:bg-[#6346E8] px-4 py-2 rounded-lg font-medium transition-all">
           <i class="ri-check-line"></i> Verifikasi
         </button>`
      : `<span class="text-gray-400">-</span>`;
    
    const row = `
      <tr class="border-b hover:bg-gray-50 transition-colors">
        <td class="px-6 py-4">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-gradient-to-br from-[#7A5AF8] to-[#9B7EF9] rounded-full flex items-center justify-center text-white font-bold">
              ${s.first_name.charAt(0)}${s.last_name.charAt(0)}
            </div>
            <div>
              <div class="font-medium text-gray-900">${s.first_name} ${s.last_name}</div>
              <div class="text-sm text-gray-500">@${s.username}</div>
            </div>
          </div>
        </td>
        <td class="px-6 py-4 text-sm">
          <div class="flex items-center gap-2 mb-1">
            <i class="ri-mail-line text-gray-400"></i>
            <span>${s.email}</span>
          </div>
          <div class="flex items-center gap-2">
            <i class="ri-phone-line text-gray-400"></i>
            <span>${s.phone || '-'}</span>
          </div>
        </td>
        <td class="px-6 py-4 text-sm text-gray-600">
          ${new Date(s.created_at).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' })}
        </td>
        <td class="px-6 py-4">${ktpButton}</td>
        <td class="px-6 py-4">
          <span class="px-3 py-1 rounded-full text-xs font-medium status-${s.status}">
            ${statusLabel}
          </span>
        </td>
        <td class="px-6 py-4 text-center">${actionButton}</td>
      </tr>`;
    
    tbody.innerHTML += row;
  });

  document.getElementById('showing-count').textContent = pageData.length;
  document.getElementById('total-count').textContent = filteredSellers.length;
}
    function renderPagination() {
      const total = Math.ceil(filteredSellers.length / itemsPerPage);
      const cont = document.getElementById('pagination-numbers');
      cont.innerHTML = '';
      for(let i=1;i<=total;i++){
        cont.innerHTML += `<button onclick="currentPage=${i};renderTable();renderPagination()" class="px-4 py-2 rounded-lg ${i===currentPage?'bg-[#7A5AF8] text-white':'bg-gray-100 hover:bg-gray-200'}">${i}</button>`;
      }
    }

    async function updateStats() {
      try {
        const statuses = ['pending', 'verified', 'rejected'];
        for (const st of statuses) {
          const resp = await fetch(`backend/api/get_sellers.php?status=${st}`);
          const data = await resp.json();
          const count = data.success ? data.data.length : 0;
          
          document.getElementById(`stat-${st}`).textContent = count;
          document.getElementById(`count-${st}`).textContent = count;
          document.getElementById(`sidebar-${st}`).textContent = count;
        }

        const totalResp = await fetch(`backend/api/get_sellers.php?status=all`);
        const totalData = await totalResp.json();
        document.getElementById('stat-total').textContent = totalData.success ? totalData.data.length : 0;
      } catch (error) {
        console.error('Error updating stats:', error);
      }
    }

    function openModal(seller) {
  currentSellerId = seller.id;
  
  // PERBAIKAN: ktp_photo sudah berisi full path dari database
  let ktpPath;
  
  if (seller.ktp_photo && seller.ktp_photo !== '') {
    // Path dari database sudah lengkap: uploads/ktp/filename.jpg
    // Tinggal tambahkan ../ karena admin.html di root, uploads di backend
    ktpPath = `backend/${seller.ktp_photo}`;
    
    console.log('KTP Photo from DB:', seller.ktp_photo);
    console.log('Final KTP Path:', ktpPath);
  } else {
    ktpPath = 'https://via.placeholder.com/800x500/cccccc/666666?text=Foto+KTP+Tidak+Tersedia';
  }
  
  // Populate data
  document.getElementById('modal-name').textContent = `${seller.first_name} ${seller.last_name}`;
  document.getElementById('modal-email').textContent = seller.email;
  document.getElementById('modal-username').textContent = '@' + seller.username;
  document.getElementById('modal-phone').textContent = seller.phone || '-';
  document.getElementById('modal-date').textContent = new Date(seller.created_at).toLocaleDateString('id-ID', {
    weekday: 'long',
    day: 'numeric',
    month: 'long',
    year: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
  
  // Set KTP image dengan error handler
  const ktpImg = document.getElementById('modal-ktp');
  ktpImg.src = ktpPath;
  
  // Handler jika gambar gagal load
  ktpImg.onerror = function() {
    console.error('Failed to load image:', ktpPath);
    this.src = 'https://via.placeholder.com/800x500/ff6b6b/ffffff?text=Foto+KTP+Gagal+Dimuat';
  };
  
  // Reset form
  document.getElementById('reject-reason').classList.add('hidden');
  document.getElementById('reject-textarea').value = '';
  
  // Show/hide elements based on status
  const actionButtons = document.getElementById('action-buttons');
  const verifiedInfo = document.getElementById('verified-info');
  const rejectedInfo = document.getElementById('rejected-info');
  
  // Hide all first
  actionButtons.classList.add('hidden');
  verifiedInfo.classList.add('hidden');
  rejectedInfo.classList.add('hidden');
  
  if (seller.status === 'pending') {
    actionButtons.classList.remove('hidden');
  } else if (seller.status === 'verified') {
    verifiedInfo.classList.remove('hidden');
    if (seller.verified_at) {
      document.getElementById('verified-date').textContent = 
        `Diverifikasi pada: ${new Date(seller.verified_at).toLocaleDateString('id-ID', {
          weekday: 'long',
          day: 'numeric',
          month: 'long',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        })}`;
    }
  } else if (seller.status === 'rejected') {
    rejectedInfo.classList.remove('hidden');
    document.getElementById('rejected-reason').textContent = seller.rejection_reason || '-';
  }
  
  // Show modal
  document.getElementById('modal').classList.remove('hidden');
  document.getElementById('modal').classList.add('flex');
}
    function closeModal(){ 
      document.getElementById('modal').classList.add('hidden');
      document.getElementById('modal').classList.remove('flex');
    }
    
    function showRejectReason(){ document.getElementById('reject-reason').classList.remove('hidden'); }
    function hideRejectReason(){ document.getElementById('reject-reason').classList.add('hidden'); }

    async function verifySeller(id, action) {
      const rejectionReason = document.getElementById('reject-textarea').value.trim();
      
      if(action==='rejected' && !rejectionReason) {
        showToast('error','Gagal','Alasan penolakan wajib diisi!');
        return;
      }

      try {
        const response = await fetch('backend/api/verify_seller.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            seller_id: id,
            action: action,
            rejection_reason: rejectionReason
          })
        });

        const result = await response.json();

        if (result.success) {
          closeModal();
          loadSellers(currentStatus);
          showToast('success', 'Sukses', result.message);
        } else {
          showToast('error', 'Gagal', result.message);
        }
      } catch (error) {
        console.error('Error:', error);
        showToast('error', 'Error', 'Terjadi kesalahan sistem');
      }
    }

    function openZoomModal(){ 
      document.getElementById('zoomed-ktp').src = document.getElementById('modal-ktp').src;
      document.getElementById('zoom-modal').classList.remove('hidden');
      document.getElementById('zoom-modal').classList.add('flex');
    }
    
    function closeZoomModal(){ 
      document.getElementById('zoom-modal').classList.add('hidden');
      document.getElementById('zoom-modal').classList.remove('flex');
    }

    function showToast(type, title, msg){
      document.getElementById('toast-title').textContent = title;
      document.getElementById('toast-message').textContent = msg;
      const icon = type==='success' ? '<i class="ri-checkbox-circle-line text-2xl"></i>' : '<i class="ri-close-circle-line text-2xl"></i>';
      document.getElementById('toast-icon').innerHTML = icon;
      document.getElementById('toast-icon').className = `w-10 h-10 rounded-lg flex items-center justify-center text-white ${type==='success'?'bg-green-500':'bg-red-500'}`;
      document.getElementById('toast').classList.remove('hidden');
      setTimeout(()=>document.getElementById('toast').classList.add('hidden'), 4000);
    }

    function refreshData(){ 
      loadSellers(currentStatus); 
      showToast('success','Refresh','Data berhasil diperbarui'); 
    }

    function logoutAdmin(e) {
    e.preventDefault();
      if (confirm('Yakin ingin logout?')) {
        fetch('backend/api/logout_admin.php')
          .then(() => {
            localStorage.removeItem('adminLoggedIn');
            localStorage.removeItem('adminRemember');
            window.location.href = 'loginAdmin.html';
          });
      }
    }
</script>
</body>
</html>